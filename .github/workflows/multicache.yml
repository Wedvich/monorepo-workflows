name: Multicache

on:
  workflow_dispatch:

jobs:
  create-cache:
    name: Create cache
    runs-on: ubuntu-latest
    strategy:
      matrix:
        package: [a, b, c]
    steps:
      - name: Make artifact
        run: |
          mkdir -p ./artifacts
          echo "This is a cache for package ${{ matrix.package }}" > ./artifacts/cache-${{ matrix.package }}.txt

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          retention-days: 1
          path: artifacts
          name: artifacts-${{ matrix.package }}

  read-cache:
    name: Read cache
    runs-on: ubuntu-latest
    needs: create-cache
    steps:
      - name: Download artifact
        uses: actions/download-artifact@v5
        with:
          path: artifacts
          pattern: artifacts-*
          merge-multiple: true

      - name: List artifacts
        run: ls -la artifacts
